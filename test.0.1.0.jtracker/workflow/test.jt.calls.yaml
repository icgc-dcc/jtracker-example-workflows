---
prepare_metadata_xml:
  input:
    metadata_git_repo: metadata_git_repo
    submitter_sample_id: submitter_sample_id
    dataset_id: dataset_id
    project_code: project_code
    metadata_path: metadata_path
  task: prepare_metadata_xml
  depends_on: 
download:
  input:
    file_name: ega_file.file_name
    ega_file_id: ega_file.ega_file_id
  task: download
  scatter:
    input:
      ega_file:
        task_suffix: ega_file.ega_file_id
        with_items: files
    name: parallel_download
  depends_on: 
md5sum_check:
  input:
    file_md5sum: ega_file.file_md5sum
    file: file@download
    file_size: ega_file.file_size
  task: md5sum_check
  scatter:
    input:
      ega_file:
        task_suffix: ega_file.ega_file_id
        with_items: files
    name: parallel_download
  depends_on:
  - completed@download@same_host
upload:
  input:
    xml_file_md5sum: xml_file_md5sum@prepare_metadata_xml
    xml_file_name: xml_file_name@prepare_metadata_xml
    xml_file: xml_file@prepare_metadata_xml
    ega_files.file: file@download
    ega_files.file_md5sum: file_md5sum@download
    xml_file_size: xml_file_size@prepare_metadata_xml
    ega_files.file_size: file_size@download
    ega_files.file_name: file_name@download
    bundle_id: bundle_id
    ega_files.ega_file_id: ega_file_id@download
  task: upload
  depends_on:
  - completed@prepare_metadata_xml
  - completed@md5sum_check
